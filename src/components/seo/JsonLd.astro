---
interface WebSiteSchema {
  type: 'WebSite';
  name?: string;
  url?: string;
}

interface OrganizationSchema {
  type: 'Organization';
  name?: string;
  url?: string;
  logo?: string;
}

interface ArticleSchema {
  type: 'Article';
  headline: string;
  description: string;
  image?: string;
  datePublished: Date;
  dateModified?: Date;
  author?: string;
  url?: string;
  keywords?: string[];
  articleSection?: string;
  inLanguage?: string;
}

interface BreadcrumbSchema {
  type: 'BreadcrumbList';
  items: Array<{
    name: string;
    url: string;
  }>;
}

interface FAQSchema {
  type: 'FAQPage';
  questions: Array<{
    question: string;
    answer: string;
  }>;
}

type SchemaType = WebSiteSchema | OrganizationSchema | ArticleSchema | BreadcrumbSchema | FAQSchema;

interface Props {
  schema: SchemaType | SchemaType[];
}

const { schema } = Astro.props;
const siteUrl = Astro.site?.toString().replace(/\/$/, '') || 'https://ondacoreana.com';

function generateSchema(s: SchemaType): object {
  switch (s.type) {
    case 'WebSite':
      return {
        '@context': 'https://schema.org',
        '@type': 'WebSite',
        name: s.name || 'OndaCoreana',
        url: s.url || siteUrl,
        inLanguage: 'es-419',
        potentialAction: {
          '@type': 'SearchAction',
          target: {
            '@type': 'EntryPoint',
            urlTemplate: `${siteUrl}/buscar?q={search_term_string}`,
          },
          'query-input': 'required name=search_term_string',
        },
      };

    case 'Organization':
      return {
        '@context': 'https://schema.org',
        '@type': 'Organization',
        name: s.name || 'OndaCoreana',
        url: s.url || siteUrl,
        logo: s.logo || `${siteUrl}/brand/og-default.svg`,
        sameAs: [
          'https://twitter.com/ondacoreana',
          'https://facebook.com/ondacoreana',
          'https://instagram.com/ondacoreana',
        ],
      };

    case 'Article':
      return {
        '@context': 'https://schema.org',
        '@type': 'Article',
        headline: s.headline,
        description: s.description,
        image: s.image?.startsWith('http') ? s.image : `${siteUrl}${s.image || '/brand/og-default.svg'}`,
        datePublished: s.datePublished.toISOString(),
        dateModified: (s.dateModified || s.datePublished).toISOString(),
        url: s.url || Astro.url.href,
        inLanguage: s.inLanguage || 'es-419',
        keywords: s.keywords?.length ? s.keywords.join(', ') : undefined,
        articleSection: s.articleSection,
        author: {
          '@type': 'Person',
          name: s.author || 'OndaCoreana',
        },
        publisher: {
          '@type': 'Organization',
          name: 'OndaCoreana',
          logo: {
            '@type': 'ImageObject',
            url: `${siteUrl}/brand/og-default.svg`,
          },
        },
        mainEntityOfPage: {
          '@type': 'WebPage',
          '@id': Astro.url.href,
        },
      };

    case 'BreadcrumbList':
      return {
        '@context': 'https://schema.org',
        '@type': 'BreadcrumbList',
        itemListElement: s.items.map((item, index) => ({
          '@type': 'ListItem',
          position: index + 1,
          name: item.name,
          item: item.url.startsWith('http') ? item.url : `${siteUrl}${item.url}`,
        })),
      };

    case 'FAQPage':
      return {
        '@context': 'https://schema.org',
        '@type': 'FAQPage',
        mainEntity: s.questions.map((q) => ({
          '@type': 'Question',
          name: q.question,
          acceptedAnswer: {
            '@type': 'Answer',
            text: q.answer,
          },
        })),
      };

    default:
      return {};
  }
}

const schemas = Array.isArray(schema) ? schema : [schema];
const jsonLdScripts = schemas.map((s) => JSON.stringify(generateSchema(s)));
---

{jsonLdScripts.map((script) => (
  <script is:inline type="application/ld+json" set:html={script} />
))}
