---
import type { ContentType } from '../../types/search';

interface Props {
  activeFilter?: ContentType;
  query?: string;
}

const { activeFilter = 'all', query = '' } = Astro.props;

// Filter options with labels and colors
const filters: { type: ContentType; label: string; testId: string }[] = [
  { type: 'all', label: 'Todos', testId: 'filter-all' },
  { type: 'dramas', label: 'K-Dramas', testId: 'filter-dramas' },
  { type: 'kpop', label: 'K-Pop', testId: 'filter-kpop' },
  { type: 'noticias', label: 'Noticias', testId: 'filter-noticias' },
  { type: 'guias', label: 'Gu√≠as', testId: 'filter-guias' },
];

// Get the base URL with query parameter
function getFilterUrl(filterType: ContentType): string {
  const params = new URLSearchParams();
  if (query) params.set('q', query);
  if (filterType !== 'all') params.set('type', filterType);
  return `/buscar?${params.toString()}`;
}
---

<div class="search-filters" data-testid="search-filters" role="tablist" aria-label="Filtrar por tipo de contenido">
  <div class="flex flex-wrap gap-2">
    {filters.map((filter) => (
      <a
        href={getFilterUrl(filter.type)}
        class:list={[
          'filter-tab px-4 py-2 rounded-full text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2',
          activeFilter === filter.type
            ? 'bg-pink-600 text-white'
            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
        ]}
        data-testid={filter.testId}
        data-filter-type={filter.type}
        role="tab"
        aria-selected={activeFilter === filter.type ? 'true' : 'false'}
        aria-controls="search-results"
      >
        {filter.label}
        <span class="filter-count ml-1 hidden" data-filter-count={filter.type}></span>
      </a>
    ))}
  </div>
</div>

<script>
  // Handle filter clicks with JavaScript for SPA-like behavior
  document.querySelectorAll('[data-testid="search-filters"] a').forEach((link) => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const href = (e.currentTarget as HTMLAnchorElement).href;

      // Update URL without full page reload
      window.history.pushState({}, '', href);

      // Trigger a custom event that buscar.astro can listen to
      window.dispatchEvent(new CustomEvent('filterchange', {
        detail: { url: href }
      }));
    });
  });
</script>
