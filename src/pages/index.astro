---
import BaseLayout from '../layouts/BaseLayout.astro';
import NewsletterForm from '../components/newsletter/NewsletterForm.astro';
import AdSlot from '../components/ads/AdSlot.astro';
import ContentCard from '../components/ui/ContentCard.astro';
import { getRecentContent } from '../utils/content-helpers';

// Obtener contenido reciente
const recentDramas = await getRecentContent('dramas', 4);
const recentKpop = await getRecentContent('kpop', 4);
const recentNoticias = await getRecentContent('noticias', 6);
---

<BaseLayout
  title="OndaCoreana - K-Dramas, K-Pop y Cultura Coreana en Español"
  description="Tu fuente definitiva de información sobre K-Dramas, K-Pop y cultura coreana en español. Noticias, guías, reseñas y más para la comunidad latina."
>
  <!-- Hero Section -->
  <section
    class="section-shell"
    style="--section-bg: linear-gradient(135deg, color-mix(in srgb, var(--md-color-primary) 80%, #111111) 0%, color-mix(in srgb, var(--md-color-tertiary) 70%, transparent) 60%); --section-color: var(--md-color-on-primary);"
  >
    <div class="section-shell__inner items-center text-center">
      <p class="chip" style="--chip-bg: color-mix(in srgb, var(--md-color-primary) 35%, transparent); --chip-color: var(--md-color-on-primary); margin: 0 auto;">
        Cultura K en español
      </p>
      <h1 class="text-4xl font-bold sm:text-5xl lg:text-6xl" style="margin-top: var(--md-spacing-md); color: inherit;">
        Tu portal de cultura coreana
      </h1>
      <p style="max-width: 42rem; margin: var(--md-spacing-md) auto 0; color: color-mix(in srgb, var(--md-color-on-primary) 80%, transparent);">
        Descubre los mejores K-Dramas, mantente al día con el K-Pop y sumérgete en la cultura coreana con guías, reseñas y noticias pensadas para la comunidad latina.
      </p>
      <div class="mt-10 flex flex-col items-center justify-center gap-4 sm:flex-row">
        <a href="/dramas" class="btn btn--primary">
          Explorar K-Dramas
        </a>
        <a
          href="/kpop"
          class="btn btn--outline"
          style="border-color: rgba(255, 255, 255, 0.6); color: var(--md-color-on-primary);"
        >
          Descubrir K-Pop
        </a>
      </div>
    </div>
  </section>

  <!-- Ad: After Hero -->
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <AdSlot slot="home-hero-bottom" format="banner" testId="ad-home-hero" />
  </div>

  <!-- Últimas Noticias -->
  <section class="section-shell" style="--section-bg: var(--md-color-surface);">
    <div class="section-shell__inner">
      <div class="flex flex-wrap items-center justify-between gap-4">
        <div>
          <p class="chip" style="--chip-bg: color-mix(in srgb, var(--md-color-primary) 16%, transparent); --chip-color: var(--md-color-on-primary-container);">
            Noticias
          </p>
          <h2 class="text-3xl font-semibold" style="color: var(--md-color-on-surface); margin-top: var(--md-spacing-sm);">
            Últimas novedades
          </h2>
        </div>
        <a href="/noticias" class="btn btn--ghost">
          Ver todas →
        </a>
      </div>

      {recentNoticias.length > 0 ? (
        <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
          {recentNoticias.map((noticia) => (
            <article class="surface-card surface-card--interactive flex flex-col" style="padding: var(--md-spacing-md); overflow: hidden; background-color: var(--md-color-surface-container-low);">
              {noticia.data.heroImage && (
                <div class="mb-4">
                  <img
                    src={noticia.data.heroImage}
                    alt={noticia.data.heroImageAlt || noticia.data.title}
                    class="w-full object-cover"
                    style="border-radius: var(--md-shape-lg); height: 12rem;"
                    loading="lazy"
                  />
                </div>
              )}
              <div class="flex flex-wrap items-center gap-2">
                <span class="chip" style="--chip-bg: color-mix(in srgb, var(--md-color-primary) 15%, transparent); --chip-color: var(--md-color-on-primary-container);">
                  {noticia.data.category}
                </span>
                {noticia.data.breaking && (
                  <span class="chip" style="--chip-bg: var(--md-color-error); --chip-color: var(--md-color-on-error);">
                    Urgente
                  </span>
                )}
              </div>
              <h3 class="headline" style="margin-top: var(--md-spacing-sm); font-size: var(--md-typo-title-large-size);">
                <a href={`/noticias/${noticia.slug}`} style="color: var(--md-color-on-surface);">
                  {noticia.data.title}
                </a>
              </h3>
              <p class="subtle-text" style="margin-top: var(--md-spacing-xs);">
                {noticia.data.description}
              </p>
              <time
                datetime={noticia.data.pubDate.toISOString()}
                style="margin-top: var(--md-spacing-sm); font-size: var(--md-typo-label-medium-size); color: color-mix(in srgb, var(--md-color-on-surface-variant) 80%, transparent);"
              >
                {noticia.data.pubDate.toLocaleDateString('es-419', { year: 'numeric', month: 'long', day: 'numeric' })}
              </time>
            </article>
          ))}
        </div>
      ) : (
        <p class="text-center subtle-text">Próximamente: noticias sobre K-Dramas y K-Pop</p>
      )}
    </div>
  </section>

  <!-- Ad: Between Noticias and Dramas -->
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <AdSlot slot="home-mid-1" format="auto" testId="ad-home-mid-1" />
  </div>

  <!-- K-Dramas Destacados -->
  <section class="section-shell" style="--section-bg: var(--md-color-surface-container);">
    <div class="section-shell__inner">
      <div class="flex flex-wrap items-center justify-between gap-4">
        <div>
          <p class="chip" style="--chip-bg: color-mix(in srgb, var(--md-color-primary) 12%, var(--md-color-surface-container)); --chip-color: var(--md-color-on-surface);">
            Reseñas
          </p>
          <h2 class="text-3xl font-semibold" style="color: var(--md-color-on-surface); margin-top: var(--md-spacing-sm);">
            K-Dramas destacados
          </h2>
        </div>
        <a href="/dramas" class="btn btn--ghost">
          Ver todos →
        </a>
      </div>

      {recentDramas.length > 0 ? (
        <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
          {recentDramas.map((drama) => (
            <ContentCard
              href={`/dramas/${drama.slug}`}
              title={drama.data.title}
              description={drama.data.description}
              heroImage={drama.data.heroImage}
              heroImageAlt={drama.data.heroImageAlt}
              imageHeight="16rem"
              descriptionClamp={2}
            >
              <Fragment slot="badges">
                {drama.data.genre?.slice(0, 2).map((g) => (
                  <span class="chip" style="--chip-bg: color-mix(in srgb, var(--md-color-primary) 10%, var(--md-color-surface-variant)); --chip-color: var(--md-color-on-surface);">
                    {g}
                  </span>
                ))}
              </Fragment>
              <Fragment slot="metadata">
                {drama.data.network && (
                  <p style="font-size: var(--md-typo-label-medium-size); color: color-mix(in srgb, var(--md-color-on-surface-variant) 80%, transparent);">
                    {drama.data.network}
                  </p>
                )}
              </Fragment>
            </ContentCard>
          ))}
        </div>
      ) : (
        <p class="text-center subtle-text">Próximamente: reseñas de los mejores K-Dramas</p>
      )}
    </div>
  </section>

  <!-- K-Pop -->
  <section class="section-shell" style="--section-bg: var(--md-color-surface);">
    <div class="section-shell__inner">
      <div class="flex flex-wrap items-center justify-between gap-4">
        <div>
          <p class="chip" style="--chip-bg: color-mix(in srgb, var(--md-color-tertiary) 18%, transparent); --chip-color: var(--md-color-on-tertiary-container);">
            K-Pop
          </p>
          <h2 class="text-3xl font-semibold" style="color: var(--md-color-on-surface); margin-top: var(--md-spacing-sm);">
            Escucha la nueva ola
          </h2>
        </div>
        <a href="/kpop" class="btn btn--ghost">
          Ver más →
        </a>
      </div>

      {recentKpop.length > 0 ? (
        <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
          {recentKpop.map((artist) => (
            <article class="surface-card surface-card--interactive text-center" style="padding: var(--md-spacing-lg);">
              <div class="mx-auto h-40 w-40 rounded-full oc-card-shine" style="overflow: hidden; box-shadow: var(--md-elevation-2);">
                {artist.data.heroImage ? (
                  <img
                    src={artist.data.heroImage}
                    alt={artist.data.heroImageAlt || artist.data.artistName}
                    class="h-full w-full object-cover"
                    loading="lazy"
                  />
                ) : (
                  <div class="flex h-full w-full items-center justify-center" style="background: color-mix(in srgb, var(--md-color-tertiary) 25%, transparent); color: var(--md-color-on-tertiary-container); font-size: 2rem; font-weight: 700;">
                    {artist.data.artistName.charAt(0)}
                  </div>
                )}
              </div>
              <h3 class="mt-4 text-lg font-semibold" style="color: var(--md-color-on-surface);">
                <a href={`/kpop/${artist.slug}`}>
                  {artist.data.artistName}
                </a>
              </h3>
              {artist.data.agency && (
                <p class="subtle-text">{artist.data.agency}</p>
              )}
              <span class="chip" style="--chip-bg: color-mix(in srgb, var(--md-color-tertiary) 12%, transparent); --chip-color: var(--md-color-on-tertiary-container); margin-top: var(--md-spacing-sm); display: inline-flex; justify-content: center;">
                {artist.data.artistType}
              </span>
            </article>
          ))}
        </div>
      ) : (
        <p class="text-center subtle-text">Próximamente: perfiles de artistas K-Pop</p>
      )}
    </div>
  </section>

  <!-- Ad: Before Newsletter -->
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <AdSlot slot="home-bottom" format="auto" testId="ad-home-bottom" />
  </div>

  <!-- Newsletter CTA -->
  <section class="py-16">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <NewsletterForm variant="card" />
    </div>
  </section>
</BaseLayout>
