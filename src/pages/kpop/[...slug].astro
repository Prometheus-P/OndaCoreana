---
import { type CollectionEntry, getCollection } from 'astro:content';
import ArticleLayout from '../../layouts/ArticleLayout.astro';
import { getRelatedEntries, loadAllArticles } from '../../lib/related';

export async function getStaticPaths() {
  const kpop = await getCollection('kpop');
  return kpop.map((artist) => ({
    params: { slug: artist.slug },
    props: artist,
  }));
}

type Props = CollectionEntry<'kpop'>;

const artist = Astro.props;
const { Content } = await artist.render();
const allArticles = await loadAllArticles();
const relatedItems = getRelatedEntries(artist, allArticles);
---

<ArticleLayout
  title={artist.data.title}
  description={artist.data.description}
  pubDate={artist.data.pubDate}
  updatedDate={artist.data.updatedDate}
  heroImage={artist.data.heroImage}
  heroImageAlt={artist.data.heroImageAlt}
  author={artist.data.author}
  tags={artist.data.tags}
  keywords={artist.data.keywords}
  breadcrumbs={[{ name: 'K-Pop', url: '/kpop' }]}
  contentType="kpop"
  affiliateHint={artist.data.affiliate_hint}
  noAds={artist.data.noAds}
  relatedItems={relatedItems}
>
  <!-- Artist Info Box -->
  <aside class="not-prose mb-8 surface-card" style="background-color: var(--md-color-surface-container); padding: var(--md-spacing-lg);">
    <h2 class="text-lg font-semibold mb-4" style="color: var(--md-color-on-surface);">Información del Artista</h2>
    <dl class="grid grid-cols-2 gap-4 text-sm" style="color: var(--md-color-on-surface);">
      <div>
        <dt class="font-medium" style="color: var(--md-color-on-surface-variant);">Nombre</dt>
        <dd>{artist.data.artistName}</dd>
      </div>
      <div>
        <dt class="font-medium" style="color: var(--md-color-on-surface-variant);">Tipo</dt>
        <dd class="capitalize">{artist.data.artistType}</dd>
      </div>
      {artist.data.agency && (
        <div>
          <dt class="font-medium" style="color: var(--md-color-on-surface-variant);">Agencia</dt>
          <dd>{artist.data.agency}</dd>
        </div>
      )}
      {artist.data.debutYear && (
        <div>
          <dt class="font-medium" style="color: var(--md-color-on-surface-variant);">Año de Debut</dt>
          <dd>{artist.data.debutYear}</dd>
        </div>
      )}
      {artist.data.members && artist.data.members.length > 0 && (
        <div class="col-span-2">
          <dt class="font-medium" style="color: var(--md-color-on-surface-variant);">Miembros</dt>
          <dd>{artist.data.members.join(', ')}</dd>
        </div>
      )}
    </dl>
  </aside>

  <Content />
</ArticleLayout>
