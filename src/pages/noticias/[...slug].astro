---
import { type CollectionEntry, getCollection } from 'astro:content';
import ArticleLayout from '../../layouts/ArticleLayout.astro';
import { getRelatedEntries, loadAllArticles } from '../../lib/related';

export async function getStaticPaths() {
  const noticias = await getCollection('noticias');
  return noticias.map((noticia) => ({
    params: { slug: noticia.slug },
    props: noticia,
  }));
}

type Props = CollectionEntry<'noticias'>;

const noticia = Astro.props;
const { Content } = await noticia.render();
const allArticles = await loadAllArticles();
const relatedItems = getRelatedEntries(noticia, allArticles);
---

<ArticleLayout
  title={noticia.data.title}
  description={noticia.data.description}
  pubDate={noticia.data.pubDate}
  updatedDate={noticia.data.updatedDate}
  heroImage={noticia.data.heroImage}
  heroImageAlt={noticia.data.heroImageAlt}
  author={noticia.data.author}
  tags={noticia.data.tags}
  keywords={noticia.data.keywords}
  breadcrumbs={[
    { name: 'Noticias', url: '/noticias' },
    { name: noticia.data.category, url: `/noticias/categoria/${noticia.data.category}` },
  ]}
  contentType="noticias"
  affiliateHint={noticia.data.affiliate_hint}
  noAds={noticia.data.noAds}
  relatedItems={relatedItems}
>
  <Content />

  {noticia.data.source && (
    <p class="mt-8 text-sm italic" style="color: var(--md-color-on-surface-variant);">
      Fuente: {noticia.data.source}
    </p>
  )}
</ArticleLayout>
