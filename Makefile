# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# HallyuLatino Makefile
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

.PHONY: help setup dev test lint format build clean docker-up docker-down

# ê¸°ë³¸ íƒ€ê²Ÿ
.DEFAULT_GOAL := help

# ë³€ìˆ˜
PYTHON := python3
PIP := pip
NPM := npm
DOCKER_COMPOSE := docker compose

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ë„ì›€ë§
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
help: ## ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´ í‘œì‹œ
	@echo "HallyuLatino ê°œë°œ ëª…ë ¹ì–´"
	@echo ""
	@echo "ì‚¬ìš©ë²•: make [ëª…ë ¹ì–´]"
	@echo ""
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-20s\033[0m %s\n", $$1, $$2}'

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ì„¤ì •
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
setup: ## ê°œë°œ í™˜ê²½ ì´ˆê¸° ì„¤ì •
	@echo "ðŸ“¦ ê°œë°œ í™˜ê²½ì„ ì„¤ì •í•©ë‹ˆë‹¤..."
	@cp -n .env.example .env || true
	@make setup-backend
	@make setup-frontend
	@echo "âœ… ì„¤ì • ì™„ë£Œ!"

setup-backend: ## ë°±ì—”ë“œ ì„¤ì •
	@echo "ðŸ ë°±ì—”ë“œ ì˜ì¡´ì„±ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤..."
	cd src/backend && $(PYTHON) -m venv venv && \
		. venv/bin/activate && \
		$(PIP) install -r requirements.txt && \
		$(PIP) install -r requirements-dev.txt

setup-frontend: ## í”„ë¡ íŠ¸ì—”ë“œ ì„¤ì •
	@echo "ðŸ“¦ í”„ë¡ íŠ¸ì—”ë“œ ì˜ì¡´ì„±ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤..."
	cd src/frontend && $(NPM) install

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ê°œë°œ ì„œë²„
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
dev: ## ì „ì²´ ê°œë°œ ì„œë²„ ì‹¤í–‰ (Docker)
	@echo "ðŸš€ ê°œë°œ ì„œë²„ë¥¼ ì‹œìž‘í•©ë‹ˆë‹¤..."
	$(DOCKER_COMPOSE) up -d

dev-backend: ## ë°±ì—”ë“œ ê°œë°œ ì„œë²„ ì‹¤í–‰
	@echo "ðŸ ë°±ì—”ë“œ ì„œë²„ë¥¼ ì‹œìž‘í•©ë‹ˆë‹¤..."
	cd src/backend && . venv/bin/activate && uvicorn main:app --reload --port 8000

dev-frontend: ## í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ ì„œë²„ ì‹¤í–‰
	@echo "âš›ï¸ í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ë¥¼ ì‹œìž‘í•©ë‹ˆë‹¤..."
	cd src/frontend && $(NPM) run dev

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# í…ŒìŠ¤íŠ¸
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
test: test-backend test-frontend ## ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰

test-backend: ## ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
	@echo "ðŸ§ª ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤..."
	cd src/backend && . venv/bin/activate && pytest tests/ -v --cov=app

test-frontend: ## í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
	@echo "ðŸ§ª í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤..."
	cd src/frontend && $(NPM) run test

test-e2e: ## E2E í…ŒìŠ¤íŠ¸ ì‹¤í–‰
	@echo "ðŸ§ª E2E í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤..."
	cd tests/e2e && $(NPM) run test

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ì½”ë“œ í’ˆì§ˆ
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
lint: lint-backend lint-frontend ## ì „ì²´ ë¦°íŠ¸ ê²€ì‚¬

lint-backend: ## ë°±ì—”ë“œ ë¦°íŠ¸ ê²€ì‚¬
	@echo "ðŸ” ë°±ì—”ë“œ ë¦°íŠ¸ë¥¼ ê²€ì‚¬í•©ë‹ˆë‹¤..."
	cd src/backend && . venv/bin/activate && ruff check . && mypy app

lint-frontend: ## í”„ë¡ íŠ¸ì—”ë“œ ë¦°íŠ¸ ê²€ì‚¬
	@echo "ðŸ” í”„ë¡ íŠ¸ì—”ë“œ ë¦°íŠ¸ë¥¼ ê²€ì‚¬í•©ë‹ˆë‹¤..."
	cd src/frontend && $(NPM) run lint

format: format-backend format-frontend ## ì „ì²´ ì½”ë“œ í¬ë§·íŒ…

format-backend: ## ë°±ì—”ë“œ ì½”ë“œ í¬ë§·íŒ…
	@echo "âœ¨ ë°±ì—”ë“œ ì½”ë“œë¥¼ í¬ë§·í•©ë‹ˆë‹¤..."
	cd src/backend && . venv/bin/activate && ruff format .

format-frontend: ## í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œ í¬ë§·íŒ…
	@echo "âœ¨ í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œë¥¼ í¬ë§·í•©ë‹ˆë‹¤..."
	cd src/frontend && $(NPM) run format

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ë¹Œë“œ
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
build: build-backend build-frontend ## ì „ì²´ ë¹Œë“œ

build-backend: ## ë°±ì—”ë“œ Docker ì´ë¯¸ì§€ ë¹Œë“œ
	@echo "ðŸ”¨ ë°±ì—”ë“œë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤..."
	docker build -t hallyulatino-backend ./src/backend

build-frontend: ## í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ
	@echo "ðŸ”¨ í”„ë¡ íŠ¸ì—”ë“œë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤..."
	cd src/frontend && $(NPM) run build

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Docker
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
docker-up: ## Docker ì„œë¹„ìŠ¤ ì‹œìž‘
	@echo "ðŸ³ Docker ì„œë¹„ìŠ¤ë¥¼ ì‹œìž‘í•©ë‹ˆë‹¤..."
	$(DOCKER_COMPOSE) up -d

docker-down: ## Docker ì„œë¹„ìŠ¤ ì¤‘ì§€
	@echo "ðŸ³ Docker ì„œë¹„ìŠ¤ë¥¼ ì¤‘ì§€í•©ë‹ˆë‹¤..."
	$(DOCKER_COMPOSE) down

docker-logs: ## Docker ë¡œê·¸ í™•ì¸
	$(DOCKER_COMPOSE) logs -f

docker-clean: ## Docker ë³¼ë¥¨ ë° ì´ë¯¸ì§€ ì •ë¦¬
	@echo "ðŸ§¹ Docker ë¦¬ì†ŒìŠ¤ë¥¼ ì •ë¦¬í•©ë‹ˆë‹¤..."
	$(DOCKER_COMPOSE) down -v --rmi local

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ë°ì´í„°ë² ì´ìŠ¤
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
db-migrate: ## ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©
	@echo "ðŸ“¦ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì ìš©í•©ë‹ˆë‹¤..."
	cd src/backend && . venv/bin/activate && alembic upgrade head

db-rollback: ## ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡¤ë°±
	@echo "âª ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ë¡¤ë°±í•©ë‹ˆë‹¤..."
	cd src/backend && . venv/bin/activate && alembic downgrade -1

db-seed: ## ì‹œë“œ ë°ì´í„° ë¡œë“œ
	@echo "ðŸŒ± ì‹œë“œ ë°ì´í„°ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤..."
	cd src/backend && . venv/bin/activate && python scripts/seed_data.py

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ì •ë¦¬
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
clean: ## ìºì‹œ ë° ë¹Œë“œ íŒŒì¼ ì •ë¦¬
	@echo "ðŸ§¹ ìºì‹œë¥¼ ì •ë¦¬í•©ë‹ˆë‹¤..."
	find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
	find . -type d -name ".pytest_cache" -exec rm -rf {} + 2>/dev/null || true
	find . -type d -name ".mypy_cache" -exec rm -rf {} + 2>/dev/null || true
	find . -type d -name "node_modules" -exec rm -rf {} + 2>/dev/null || true
	find . -type d -name ".next" -exec rm -rf {} + 2>/dev/null || true
	@echo "âœ… ì •ë¦¬ ì™„ë£Œ!"
